<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculateur O₂ TIH SAMU 74</title>
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icon-1024.png">

  <style>
    :root{
      --bg1:#070b16; --bg2:#0b1731;
      --card:#0f1a33cc;
      --stroke:#22325f; --stroke2:#2a3f78;
      --text:#e8efff; --muted:#a9b7e6;
      --ok:#20e3a2; --warn:#ffcc80; --bad:#ff6b8a;
      --pGreen:#20e3a2; --pYellow:#ffd166; --pRed:#ff6b8a; --pBlue:#6aa6ff;
      --r:18px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 500px at 20% -10%, #2a5bff33, transparent 60%),
        radial-gradient(700px 520px at 100% 10%, #00d6ff22, transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }

    .wrap{ max-width:980px; margin:0 auto; padding:18px; }
    h1{ font-size:18px; margin:0; }
    .subtitle{ font-size:12px; color:var(--muted); }

    .card{
      background:linear-gradient(180deg, var(--card), #0b1430cc);
      border:1px solid var(--stroke);
      border-radius:var(--r);
      padding:14px;
      margin:12px 0;
    }

    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media(max-width:560px){ .grid{ grid-template-columns:1fr; } }

    label{ font-size:12px; color:var(--muted); display:block; margin-bottom:6px; }

    input{
      width:100%;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background:#0b142d;
      color:var(--text);
    }

    .row{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      border:1px solid var(--stroke);
      background:#0b142d;
      border-radius:999px;
      padding:8px 12px;
      font-size:12px;
      cursor:pointer;
    }
    .chip.active{
      border-color:#4a6bff;
      background:#142b66;
    }

    .kpi{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media(max-width:560px){ .kpi{ grid-template-columns:1fr; } }

    .box{
      background:#0b142d;
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:12px;
    }
    .box .t{ font-size:12px; color:var(--muted); }
    .box .v{ font-size:20px; font-weight:900; margin-top:6px; }

    .status{
      margin-top:12px;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background:#0b142d;
      display:flex;
      gap:10px;
    }

    .badge{ font-weight:900; }
    .ok{ color:var(--ok); }
    .warn{ color:var(--warn); }
    .bad{ color:var(--bad); }

    .bottles{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media(max-width:860px){ .bottles{ grid-template-columns:1fr; } }

    .bottle{
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:12px;
      background:#0b142d;
    }

    .pTag{
      margin-top:6px;
      padding:6px 10px;
      border-radius:999px;
      font-weight:900;
      border:1px solid var(--stroke);
      width:fit-content;
    }
    .pGreen{ color:var(--pGreen); border-color:var(--pGreen); }
    .pYellow{ color:var(--pYellow); border-color:var(--pYellow); }
    .pRed{ color:var(--pRed); border-color:var(--pRed); }
    .pBlue{ color:var(--pBlue); border-color:var(--pBlue); }

    footer{ margin-top:10px; font-size:12px; color:var(--muted); }
  </style>
</head>

<body>
<div class="wrap">
  <h1>Calculateur O₂ — TIH SAMU 74</h1>
  <div class="subtitle">Stock : 1×15L + 2×5L • Bouteilles sup : 5L à 200 bar</div>

  <div class="card">
    <div class="grid">
      <div>
        <label>Débit (L/min)</label>
        <input id="flow" type="number" step="0.1" value="6">
      </div>

      <div>
        <label>Durée (min)</label>
        <input id="mins" type="number" value="60">
      </div>

      <div style="grid-column:1/-1">
        <label>Marge de sécurité</label>
        <div class="row" id="marginChips">
          <span class="chip" data-margin="10">10%</span>
          <span class="chip active" data-margin="20">20%</span>
          <span class="chip" data-margin="30">30%</span>
          <span class="chip" data-margin="40">40%</span>
          <span class="chip" data-margin="50">50%</span>
        </div>
        <div class="subtitle">Marge actuelle : <b id="marginLabel">20%</b></div>
      </div>

      <div><label>15 L (bar)</label><input id="p15" type="number" value="200"></div>
      <div><label>5 L #1 (bar)</label><input id="p5a" type="number" value="200"></div>
      <div><label>5 L #2 (bar)</label><input id="p5b" type="number" value="200"></div>
    </div>
  </div>

  <div class="card">
    <div class="kpi">
      <div class="box"><div class="t">Besoin</div><div class="v" id="need">—</div></div>
      <div class="box"><div class="t">Disponible</div><div class="v" id="available">—</div></div>
      <div class="box"><div class="t">Temps dispo</div><div class="v" id="timeAvailable">—</div></div>
      <div class="box"><div class="t">Marge temps</div><div class="v" id="timeMargin">—</div></div>
    </div>

    <div class="status">
      <div class="badge" id="badge">—</div>
      <div id="statusLine">—</div>
    </div>

    <div class="bottles" id="bottles"></div>
    <footer>Baptiste Ribéron — Décembre 2025</footer>
  </div>
</div>

<script>
const EXTRA_BOTTLE = 1000;
let marginPct = 20;

const flow = document.getElementById("flow");
const mins = document.getElementById("mins");
const p15 = document.getElementById("p15");
const p5a = document.getElementById("p5a");
const p5b = document.getElementById("p5b");

const needEl = document.getElementById("need");
const availEl = document.getElementById("available");
const tAvailEl = document.getElementById("timeAvailable");
const tMarginEl = document.getElementById("timeMargin");
const badge = document.getElementById("badge");
const statusLine = document.getElementById("statusLine");
const bottlesEl = document.getElementById("bottles");
const marginLabel = document.getElementById("marginLabel");

function pressureClass(bar){
  if(bar <= 50) return "pRed";
  if(bar <= 100) return "pYellow";
  if(bar <= 200) return "pGreen";
  return "pBlue";
}

function calc(){
  const f = Math.max(0, +flow.value);
  const m = Math.max(0, +mins.value);

  const need = f * m * (1 + marginPct/100);
  const total = p15.value*15 + p5a.value*5 + p5b.value*5;

  needEl.textContent = Math.round(need)+" L";
  availEl.textContent = Math.round(total)+" L";

  const tAvail = total / (f || 1);
  const tMargin = tAvail - m*(1+marginPct/100);

  tAvailEl.textContent = Math.round(tAvail)+" min";
  tMarginEl.textContent = (tMargin>=0?"+":"")+Math.round(tMargin)+" min";

  bottlesEl.innerHTML = `
    <div class="bottle">15 L<div class="pTag ${pressureClass(p15.value)}">${p15.value} bar</div></div>
    <div class="bottle">5 L #1<div class="pTag ${pressureClass(p5a.value)}">${p5a.value} bar</div></div>
    <div class="bottle">5 L #2<div class="pTag ${pressureClass(p5b.value)}">${p5b.value} bar</div></div>
  `;

  if(total >= need){
    badge.className="badge ok";
    badge.textContent="OK";
    statusLine.textContent="Stock suffisant avec marge.";
  }else{
    const missing = need-total;
    const nb = Math.ceil(missing/EXTRA_BOTTLE);
    badge.className="badge bad";
    badge.textContent="KO";
    statusLine.textContent=`Prévoir ${nb} bouteille(s) 5 L à 200 bar.`;
  }
}

document.querySelectorAll("#marginChips .chip").forEach(c=>{
  c.onclick=()=>{
    marginPct=+c.dataset.margin;
    marginLabel.textContent=marginPct+"%";
    document.querySelectorAll("#marginChips .chip").forEach(x=>x.classList.remove("active"));
    c.classList.add("active");
    calc();
  };
});

[flow, mins, p15, p5a, p5b].forEach(i=>i.oninput=calc);
calc();
</script>
</body>
</html>
